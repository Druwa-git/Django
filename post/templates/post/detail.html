<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <title>Django Post</title>
    <script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
    <!-- <script src="https://unpkg.com/vue-router/dist/vue-router.js"></script> -->
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css" integrity="sha384-TX8t27EcRE3e/ihU7zmQxVncDAy5uIKz4rEkgIXeMed4M0jlfIDPvg6uqKI2xXr2" crossorigin="anonymous">
</head>
<body>
    <div id="posting">
        <div class="container">
            <h1>Post Detail</h1>
            <table class="table">
                <tr>
                    <td>uid</td>
                    <td>${post.uid}</td>
                </tr>
                <tr>
                    <td>title</td>
                    <td>${post.title}</td>
                </tr>
                <tr>
                    <td>author</td>
                    <td>${post.author}</td>
                </tr>
                <tr>
                    <td>만든 날짜</td>
                    <td>${post.created_at}</td>
                </tr>
                <tr>
                    <td>수정한 날짜</td>
                    <td>${post.edited_at}</td>
                </tr>
            </table>
            <h2>CONTENT</h2>
            <div style="border : 3px solid black; padding: 50px;">${post.content}</div>
            <br>
            <a :html="'/post/'">Go to post list page</a>
            <br>
            <a href="javascript:history.back()">Go to post list page</a>
        </div>
    </div>
    <br />
    <hr />
    <br />
    <div id="comments">
        <div class="container">
            <h2>COMMENT</h2>
            <table class="table">
                <tr v-for="comment in comments">
                    <div class="comment_header">
                        <div class="comment_author"><td>${comment.author}</td></div>
                        <div class="comment_date"><td>${comment.created_at}</td></div>
                    </div>
                    <br />
                    <div class="comment_body">
                        <td>${comment.content}</td>
                    </div>
                </tr>
            </table>
        </div>
    </div>
    <script type="text/javascript">
        var getParameters = function (paramName) {
            var returnValue;
            var url = location.href;
            var parameters = (url.slice(url.indexOf('?') + 1, url.length)).split('&');

            for (var i = 0; i < parameters.length; i++) {
                var varName = parameters[i].split('=')[0];
                if (varName.toUpperCase() == paramName.toUpperCase()) {
                    returnValue = parameters[i].split('=')[1];
                    return decodeURIComponent(returnValue);
                }
            }
        };

        const posting = new Vue({
            el: '#posting',
            delimiters: ['${', '}'],
            data: {
                post: {},
                loading: true,
                // message: null,
            },
            mounted: function () {
                this.getPost(getParameters('uid'));
            },
            methods: {
                getPost: function (pk) {
                    this.loading = true;
                    axios.get('/post/api/' + pk + '/')
                        .then((response) => {
                            this.post = response.data;
                            this.loading = false;
                        })
                        .catch((err) => {
                            this.loading = false;
                            console.log(err);
                        })
                }
            },
        })

        const comments = new Vue({
            el: '#comments',
            delimiters: ['${', '}'],
            data: {
                comments: [],
                loading: true,
            },
            mounted: function () {
                this.getComments(getParameters('uid'));
            },
            methods: {
                getComments: function (pk) {
                    this.loading = true;
                    axios.get('/post/api/' + pk + '/comments/')
                        .then((response) => {
                            this.comments = response.data;
                            this.loading = false;
                        })
                        .catch((err) => {
                            this.loading = false;
                            console.log(err);
                        })
                }
            }
        })
                /* const router = new VueRouter({
                routes: [
                    { path: '/post/detail/:uid', component: posting, props: true }
                ]
            }) */

    </script>
</body>
</html>